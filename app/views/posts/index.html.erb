<h1 class="my-4">Posts</h1>

<% if current_user.admin? %>
  <h2 class="mb-3">Posts Pending Review</h2>
  <table class="table table-bordered table-hover">
    <thead class="table-dark">
    <tr>
      <th>Content</th>
      <th>Author</th>
      <th>Region</th>
      <th>Actions</th>
    </tr>
    </thead>
    <tbody>
    <% @posts.pending_review.each do |post| %>
      <tr>
        <td><%= post.content.truncate(50) %></td>
        <td><%= post.user.full_name %></td>
        <td><%= post.region_id %></td>
        <td>
          <div class="d-flex gap-2">
            <%= button_to 'Approve', approve_post_path(post), method: :patch, class: "btn btn-success btn-sm" %>
            <%= button_to 'Reject', reject_post_path(post), method: :patch, class: "btn btn-danger btn-sm" %>
          </div>
        </td>
      </tr>
    <% end %>
    </tbody>
  </table>

<% else %>
  <h2 class="mb-3">Your Posts</h2>
  <%= link_to "Create New Post", new_post_path, class: "btn btn-primary mb-3" %>
  <table class="table table-bordered table-hover">
    <thead class="table-dark">
    <tr>
      <th>Content</th>
      <th>Status</th>
      <th>Actions</th>
    </tr>
    </thead>
    <tbody>
    <% @posts.each do |post| %>
      <tr>
        <td><%= post.content.truncate(50) %></td>
        <td><%= post.status.humanize %></td>
        <% if post.draft? %>
          <td>
            <div class="d-flex justify-content-start gap-2">
              <%= link_to "Edit", edit_post_path(post), class: "btn btn-secondary btn-sm" %>
              <%= button_to "Delete", post_path(post), method: :delete, data: { confirm: "Are you sure?" }, class: "btn btn-danger btn-sm" %>
              <%= button_to "Send", send_for_review_post_path(post), method: :patch, class: "btn btn-primary btn-sm", data: { confirm: "Are you sure you want to send this post for review?" } %>
            </div>
          </td>
        <% end %>
      </tr>
    <% end %>
    </tbody>
  </table>
<% end %>
